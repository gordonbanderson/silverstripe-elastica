#How Data Is Indexed and Searched
##Overview
Elasticsearch is a complex beast, this module attempts to hide that complexity
from the SilverStripe developer.  Indexed data is stored in what are known as
multi fields in Elasticsearch.  In this module indexed data is stored as
follows:

* FieldName - stemmed text
* FieldName.standard - unstemmed text
* FieldName.shingles - pairs of consecutive words

and for fields that have autocompletion enabled:

* FieldName.autocomplete - groups of consecutive letters to be used for
autocompletion search functionality.

More details about each indexing method is below.

##Worked Example
Consider the following Flickr photograph with Title and Description both being:

```
Cambridge and Kent Terraces, Wellington, [ca 1930s]
```

![Editing a Flickr Photo]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-edit-flickrphoto.png
"Editing a Flickr photo")

###Unstemmed Terms
Tokens are generated by splitting at word boundaries, the exact details being
dependent upon the language being indexed.  No reduction of the terms takes
place.

![Unstemmed Terms for the Description]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-unstemmed.png
"Unstemmed Terms for the Description")

###Stemmed Terms
Tokens are generated as per unstemmed terms, but then the terms are passed
through what is known as a 'stemmer' reducing the tokens to a 'root form'.  This
is best explained by example.  Terms such as _laughs_, _laughed_, and _laughing_
get reduced to the form _laugh_.  The idea here is that when a user searches for
_laugh_ then documents containing _laughs_, _laughed_ or _laughing_ would match
and show as a result for the search.

In the example below the term _terraces_ has been reduced to _terrac_ - note
also that the number of occurrences of a stemmed term will be more than an
unstemmed one.  In this case _terrac_ occurs 22 times whereas _terraces_ occurs
only 11 times in the index.

It should also be noted that there is often more than one stemmer available for
any given language.  For English both the Porter and Snowball stemming
algorithms are supported.

![Stemmed Terms for the Description]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-stemmed.png
"Stemmed Terms for the Description")

###Shingles
Shingles, or word n-grams, are pairs, triples, or quadruples etc of terms
indexed as a single token in the index.  The Elasticsearch documentation
indicates that two is enough for good phrase matching.

Using the example text above, the shingles formed are:

Cambridge and Kent Terraces, Wellington, [ca 1930s]

```
cambridge and
and kent
kent terraces
terraces wellington
wellington ca
ca 1930s
```

When a search for 'Cambridge and Kent' is made, it will be broken down into
it's shingles 'cambridge and', 'and kent', this provides 2 adjacent matches
that are unique within the entire index for the document below.  This will mean
the phrase match ranking higher in the search results.


![Shingle Terms for the Description Field]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-shingles.png
"Shingle Terms for the Description Field")

See https://www.elastic.co/blog/searching-with-shingles for more information.

###Autocompletion
In order for autocompletion to be fast, a large number of tokens are indexed.
For a word such as _Cambridge_ the following are indexed.
```
ca, am, mb, ri, id, dg, ge, cam, amb, mbr, bri, rid, idg, dge, camb, ambr, mbri,
brid, ridg, idge, cambr, ambri, mbrid, bridg, ridge, cambri, ambrid, mbridg,
bridge, cambridg, ambridge, cambridge
```
It should be immediately clear that if one types any part of the word Cambridge
then the above terms would match.  The indexing technique is known as n-grams.

For the original example we can see that there are 173 indexed tokens for this
short title alone.  This technique should only be used on short fields.

![nGrams for Autocompletion of the Title Field]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-ngrams.png
"nGrams for Autocompletion of the Title Field")

See
http://jontai.me/blog/2013/02/adding-autocomplete-to-an-elasticsearch-search-application/
for more information.

![Editing a Flickr Photo]
(https://raw.githubusercontent.com/gordonbanderson/silverstripe-elastica/screenshots/screenshots/elastica-edit-flickrphoto.png
"Editing a Flickr photo")

##Searching
When a search is performed the query is converted into each of stemmed,
unstemmed and shingles as above.  Each field is searched and the resultant
scores combined to form the final ranking.

Note that currently it is not possible to apply a separate weighting to each
of stemmed, unstemmed, and shingles but this is a desirable TODO - see
https://github.com/gordonbanderson/silverstripe-elastica/issues/31
